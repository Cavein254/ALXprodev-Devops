#!/bin/bash

INPUT_DIR="pokemon_data"
OUTPUT_FILE="pokemon_report.csv"

# Check if directory exists
if [ ! -d "$INPUT_DIR" ]; then
  echo "Error: Directory $INPUT_DIR does not exist. Run ./fetch_multiple_pokemon first."
  exit 1
fi

# Initialize CSV file
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_FILE"

# Extract data from JSON files
for file in "$INPUT_DIR"/*.json; do
  name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
  height=$(jq -r '.height' "$file" | awk '{printf "%.1f", $1/10}')
  weight=$(jq -r '.weight' "$file" | awk '{printf "%.1f", $1/10}')

  echo "$name,$height,$weight" >> "$OUTPUT_FILE"
done

# Print CSV file path
echo "CSV Report generated at: $OUTPUT_FILE"
echo

# Print CSV content
cat "$OUTPUT_FILE"
echo

# Calculate average height and weight using awk
awk -F',' 'NR>1 {total_h+=$2; total_w+=$3; count++}
END {
  printf "\nAverage Height: %.2f m\n", total_h/count
  printf "Average Weight: %.2f kg\n", total_w/count
}' "$OUTPUT_FILE"
